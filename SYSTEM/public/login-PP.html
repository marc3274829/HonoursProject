<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log-in</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
        background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000;">
    <div style="background:#fff; padding:20px 30px; border-radius:8px; text-align:center; min-width:250px;">
        <p id="modalMessage"></p>
        <button id="modalOk" style="margin-top:15px; padding:5px 15px;">OK</button>
    </div>
    </div>
<div class="formBox">
    <h2>Log-in</h2>

    <form action="/login" method="POST" id="loginForm">
        <div class="formInput">
            <p>Email</p>
            <input name="email" type="text" id="loginUsername" required>
            <p>Password</p>
            <input name="password" type="password" id="loginPassword" required>
        </div>
        <div class="button">
            <button type="submit" class="submit" id="sButton">Submit</button>
        </div>
        
    </form>
</div>
</body>
<script>
    const form = document.getElementById('loginForm');
    const modal = document.getElementById('modal');
    const modalMessage = document.getElementById('modalMessage');
    const modalOk = document.getElementById('modalOk');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());

        try {
            const res = await fetch('/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            let message = await res.text();


            if (!message) {
                message = "Login failed";
            }
            showModal(message);

        } catch (err) {
            showModal("Cannot connect to server");
        }
    });

    function showModal(message) {
        modalMessage.textContent = message;
        modal.style.display = 'flex';
    }

    modalOk.addEventListener('click', () => {
        modal.style.display = 'none';

        if (modalMessage.textContent === "Login successful") {
            window.location.href = "confirmationPP.html";
        }
    });
</script>
</html>